<!-- /templates/collection.make.liquid -->
{% comment %}

  For more information on collection tags:
    - http://docs.shopify.com/themes/liquid-variables/collection

{% endcomment %}

{% paginate collection.products by 12 %}

{% include 'breadcrumb' %}

{% comment %}
  Use .grid--rev so that the collection tags appear below the products on mobile
{% endcomment %}
<div class="grid--rev">

  <div class="grid__item large--one-whole">
    
        {% comment %}
            https://help.shopify.com/themes/customization/collections/filter-collections-with-product-tags
        {% endcomment %}

      <div class="clearfix filter">
        <p>Browse by Model:</p>
        <select class="coll-filter">
          <option value="">All</option>
          {% for tag in collection.all_tags %}
          {% capture this_tag %}{{ tag | downcase }}{% endcapture %}
          {% if current_tags contains tag %}
          <option value="{{ tag | handle }}" selected>{{ tag }}</option>
          {% elsif this_tag == collection.handle %}
          {% else %}
          <option value="{{ tag | handle }}">{{ tag }}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>
        </div>
  
  <div class="grid__item large--one-whole">


{% comment %}
  Loop through each collection, except 'frontpage'
{% endcomment %}
{% for collection in collection %}

  {% unless collection.handle == 'frontpage' %}

    {% capture collection_title %}{{ collection.title | escape }}{% endcapture %}

    <div class="section-header">
      <p class="h1 section-header__left">{{ collection_title }}</p>
      <div class="section-header__right">
        <a href="{{ collection.url }}" title="{{ 'collections.general.link_title' | t: title: collection_title }}">More {{ collection_title }} &rsaquo;</a>
      </div>
    </div>

    <div class="grid-uniform">
      {% for product in collection.products limit:5 %}
        {% assign grid_item_width = 'large--one-fifth medium--one-half' %}
        {% include 'product-grid-item' %}
      {% endfor %}
    </div>

    {% unless forloop.last %}<hr>{% endunless %}

  {% endunless %}

{% endfor %}

  </div>


</div>

{% endpaginate %}



<script>
  /* Product Tag Filters - Good for any number of filters on any type of collection pages */
  var collFilters = jQuery('.coll-filter');
  collFilters.change(function() {
    var newTags = [];
    collFilters.each(function() {
      if (jQuery(this).val()) {
        newTags.push(jQuery(this).val());
      }
    });
    if (newTags.length) {
      var query = newTags.join('+');
      window.location.href = jQuery('{{ 'tag' | link_to_tag: 'tag' }}').attr('href').replace('tag', query);
    }
    else {
      {% if collection.handle %}
      window.location.href = '/collections/{{ collection.handle }}';
      {% elsif collection.products.first.type == collection.title %}
      window.location.href = '{{ collection.title | url_for_type }}';
      {% elsif collection.products.first.vendor == collection.title %}
      window.location.href = '{{ collection.title | url_for_vendor }}';
      {% endif %}
    }
  });
</script>