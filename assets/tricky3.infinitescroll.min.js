!function(e){e.fn.TrickyInfiniteScroll=function(t){var o={ParentProductsWrapper:null,IsRequestOn:!1,NextPageLink:null,PreviousPageLink:null,InitialNextPageLink:null,NeedToLoadOnlyNextPages:!1,NeedToLoadOnlyPreviousPages:!1,NeedToLoadBothPreviousAndNextPages:!1,UrlToLoad:null,UpdateHashOnWindowScrollLoaded:!1,Opts:{Selectors:{ParentProductsWrapper:".collection-matrix",Product:"li",NextPageLink:"#NextPaginationLink a",PreviousPageLink:"#PreviousPaginationLink a"},PageQueryStringKey:"page",WaitForImagesToBeLoaded:!1,EnableHasherModule:!1,CallBack:function(){},CallBackOnPageLoad:function(){},CallBackBeforePageLoad:function(){}}};o.Opts=e.extend(o.Opts,t),o.ParentProductsWrapper=this,o.NextPageLink=e(o.Opts.Selectors.NextPageLink),o.InitialNextPageLink=o.NextPageLink,o.PreviousPageLink=e(o.Opts.Selectors.PreviousPageLink),o.NeedToLoadOnlyNextPages=0==o.PreviousPageLink.length&&1==o.NextPageLink.length,o.NeedToLoadOnlyPreviousPages=1==o.PreviousPageLink.length&&0==o.NextPageLink.length,o.NeedToLoadBothPreviousAndNextPages=1==o.PreviousPageLink.length&&1==o.NextPageLink.length,o.UpdateHashOnWindowScrollLoaded=!1;var a,n=function(){if(null!=o.NextPageLink&&1==o.NextPageLink.length||null!=o.PreviousPageLink&&1==o.PreviousPageLink.length){var t=e(window).scrollTop(),a=t+e(window).height(),n=e(o.Opts.Selectors.Product+":visible:last",o.ParentProductsWrapper).offset().top,l=n+e(o.Opts.Selectors.Product+":visible:last",o.ParentProductsWrapper).height();!o.IsRequestOn&&a>=l&&n>=t&&(o.Opts.CallBackBeforePageLoad(),r.SetUpUrlToLoad(),e.get(o.UrlToLoad,i),o.IsRequestOn=!0)}else o.Opts.CallBack(),e(window).unbind("scroll.trickyInfiniteScroll")},i=function(t){var a=e(t).find(o.Opts.Selectors.ParentProductsWrapper);if(o.NextPageLink=e(t).find(o.Opts.Selectors.NextPageLink),o.PreviousPageLink=e(t).find(o.Opts.Selectors.PreviousPageLink),o.Opts.WaitForImagesToBeLoaded){var n=e("img",a).length,i=1,s=!1;e("img",a).load(function(){i++,i>=n&&o.IsRequestOn&&!s&&(r.FireAllCallBacks(a),s=!0)}).each(function(){this.complete&&e(this).load()})}else r.FireAllCallBacks(a);o.Opts.EnableHasherModule&&!o.UpdateHashOnWindowScrollLoaded&&(o.UpdateHashOnWindowScrollLoaded=!0,l.UpdateHashOnWindowScrollStopped())},r={FireAllCallBacks:function(e){o.Opts.EnableHasherModule&&l.HashUrlAndAddPageAttributesToProducts(e),o.ParentProductsWrapper.append(e.html()),r.ReloadPageLinksObjectsAndVariables(),o.Opts.CallBackOnPageLoad(),o.IsRequestOn=!1},AddPageNumberAttributesToExistingProducts:function(){var t=r.GetParameterByName(window.location.href,o.Opts.PageQueryStringKey);e(o.Opts.Selectors.Product,o.ParentProductsWrapper).attr("data-pagenumber",""==t?1:t)},GetParameterByName:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+t+"=([^&#]*)"),a=o.exec(e);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))},ReloadPageLinksObjectsAndVariables:function(){o.NeedToLoadOnlyNextPages&&0==o.NextPageLink.length&&(o.NeedToLoadOnlyNextPages=!1,o.PreviousPageLink=o.NextPageLink=null),o.NeedToLoadOnlyPreviousPages&&0==o.PreviousPageLink.length&&(o.NeedToLoadOnlyPreviousPages=!1,o.NextPageLink=o.PreviousPageLink=null)},SetUpUrlToLoad:function(){o.NeedToLoadOnlyPreviousPages&&(o.UrlToLoad=o.PreviousPageLink.attr("href")),o.NeedToLoadOnlyNextPages&&(o.UrlToLoad=o.NextPageLink.attr("href")),o.NeedToLoadBothPreviousAndNextPages&&(o.PreviousPageLink.length?o.UrlToLoad=o.PreviousPageLink.attr("href"):null!=o.InitialNextPageLink&&(o.UrlToLoad=o.InitialNextPageLink.attr("href"),o.NeedToLoadOnlyNextPages=!0,o.NeedToLoadBothPreviousAndNextPages=!1))}},l={CheckHashAndReloadPageIfNeeded:function(){var e=window.location.hash;if(e&&-1!=e.indexOf(o.Opts.PageQueryStringKey)){var t=e.split("=")[1],a=window.location.href.replace(e,""),n=window.location.search;if(""==n)window.location.href=a+"?"+o.Opts.PageQueryStringKey+"="+t;else{for(var i=n.replace("?","").split("&"),r="",l=0;l<i.length;l++)-1==i[l].indexOf(o.Opts.PageQueryStringKey+"=")&&(r+=i[l]+"&");var a=window.location.href.replace(window.location.hash,"").replace(window.location.search,"");a=""!=r?a+"?"+r+o.Opts.PageQueryStringKey+"="+t:a+"?"+o.Opts.PageQueryStringKey+"="+t,window.location.href=a}}},HashUrlAndAddPageAttributesToProducts:function(t){var a=r.GetParameterByName(o.UrlToLoad,o.Opts.PageQueryStringKey);a&&(e(o.Opts.Selectors.Product,t).attr("data-pagenumber",a),window.location.hash=o.Opts.PageQueryStringKey+"="+a)},UpdateHashOnWindowScrollStopped:function(){e(window).scrollStopped(function(){e(o.Opts.Selectors.Product,o.ParentProductsWrapper).each(function(){e(this).visible(!0)?(e(this).addClass("in-viewport"),e(this).removeClass("not-in-viewport")):(e(this).removeClass("in-viewport"),e(this).addClass("not-in-viewport"))});var t=e(o.Opts.Selectors.Product+".in-viewport",o.ParentProductsWrapper).first();1==t.length&&(window.location.hash=o.Opts.PageQueryStringKey+"="+t.attr("data-pagenumber"))})}};o.Opts.EnableHasherModule&&l.CheckHashAndReloadPageIfNeeded(),r.AddPageNumberAttributesToExistingProducts(),e(window).bind("scroll.trickyInfiniteScroll",n),e(window).resize(function(){a&&clearTimeout(a),a=setTimeout(function(){e(window).unbind("scroll.trickyInfiniteScroll"),e(window).bind("scroll.trickyInfiniteScroll",n)},1e3)})}}(jQuery),function(e){e.fn.scrollStopped=function(t){e(this).scroll(function(){var o=this,a=e(o);a.data("scrollTimeout")&&clearTimeout(a.data("scrollTimeout")),a.data("scrollTimeout",setTimeout(t,250,o))})}}(jQuery),function(e){e.fn.visible=function(t,o,a){var n=e(this).eq(0),i=n.get(0),r=e(window),l=r.scrollTop(),s=l+r.height(),d=r.scrollLeft(),P=d+r.width(),c=n.offset().top,u=c+n.height(),g=n.offset().left,p=g+n.width(),h=t===!0?u:c,L=t===!0?c:u,f=t===!0?p:g,O=t===!0?g:p,k=o===!0?i.offsetWidth*i.offsetHeight:!0,a=a?a:"both";return"both"===a?!!k&&s>=L&&h>=l&&P>=O&&f>=d:"vertical"===a?!!k&&s>=L&&h>=l:"horizontal"===a?!!k&&P>=O&&f>=d:void 0}}(jQuery);